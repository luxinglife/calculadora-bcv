<!DOCTYPE html>
<html lang="es">
<head>
    <!-- (Todo el head y estilos IGUAL que antes, no los repito para no alargar) -->
</head>
<body>
    <div class="glass-container">
        <!-- (Todo el HTML visual IGUAL que antes) -->
    </div>

    <script>
        // ============================================
        // FRONTEND CON BACKEND PROPIO
        // ============================================
        let tasaBCV = 0;
        let tasaUSDT = 0;

        // Elementos del DOM (igual que antes)
        const tasaBCVEl = document.getElementById('tasaBCV');
        const tasaUSDTEl = document.getElementById('tasaUSDT');
        const lastUpdateEl = document.getElementById('lastUpdate');
        
        const inputBs = document.getElementById('inputBs');
        const resultBsToUsdt = document.getElementById('resultBsToUsdt');
        const resultBsToUsd = document.getElementById('resultBsToUsd');
        
        const inputUsdt = document.getElementById('inputUsdt');
        const resultUsdtToBsP2P = document.getElementById('resultUsdtToBsP2P');
        const resultUsdtToBsBCV = document.getElementById('resultUsdtToBsBCV');

        const refreshBtn = document.getElementById('refreshBtn');

        function formatearFecha() {
            const ahora = new Date();
            return ahora.toLocaleTimeString('es-VE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        // ===== CAMBIO IMPORTANTE: llamar a TU backend =====
        const BACKEND_URL = 'https://calculadora-bcv-api.onrender.com/api/tasas'; // <-- REEMPLAZA CON TU URL DE RENDER

        async function obtenerTasas() {
            tasaBCVEl.innerText = 'Bs ...';
            tasaUSDTEl.innerText = 'Bs ...';
            if (lastUpdateEl) lastUpdateEl.innerText = 'Actualizando...';

            try {
                const response = await fetch(BACKEND_URL);
                if (!response.ok) throw new Error('Error en la respuesta del backend');
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                tasaBCV = data.bcv;
                tasaUSDT = data.usdt;

                tasaBCVEl.innerText = `Bs ${tasaBCV.toFixed(2)}`;
                tasaUSDTEl.innerText = `Bs ${tasaUSDT.toFixed(2)}`;
                if (lastUpdateEl) lastUpdateEl.innerText = `Última actualización: ${formatearFecha()}`;
                calcularTodos();

            } catch (error) {
                console.error('Error:', error);
                tasaBCV = 36.0;
                tasaUSDT = 40.0;
                tasaBCVEl.innerText = `⚠️ Bs ${tasaBCV.toFixed(2)}`;
                tasaUSDTEl.innerText = `⚠️ Bs ${tasaUSDT.toFixed(2)}`;
                if (lastUpdateEl) lastUpdateEl.innerText = 'Error al conectar con el backend. Usando valores aproximados.';
                calcularTodos();
            }
        }

        // Funciones de cálculo (igual que antes)
        function calcularBsTo() {
            const montoBs = parseFloat(inputBs.value) || 0;
            resultBsToUsdt.innerText = (montoBs > 0 && tasaUSDT > 0) ? (montoBs / tasaUSDT).toFixed(4) + ' USDT' : '0.00 USDT';
            resultBsToUsd.innerText = (montoBs > 0 && tasaBCV > 0) ? (montoBs / tasaBCV).toFixed(2) + ' $' : '0.00 $';
        }

        function calcularUsdtTo() {
            const montoUsdt = parseFloat(inputUsdt.value) || 0;
            resultUsdtToBsP2P.innerText = (montoUsdt > 0 && tasaUSDT > 0) ? (montoUsdt * tasaUSDT).toFixed(2) + ' Bs' : '0.00 Bs';
            resultUsdtToBsBCV.innerText = (montoUsdt > 0 && tasaBCV > 0) ? (montoUsdt * tasaBCV).toFixed(2) + ' Bs' : '0.00 Bs';
        }

        function calcularTodos() {
            calcularBsTo();
            calcularUsdtTo();
        }

        inputBs.addEventListener('input', calcularBsTo);
        inputUsdt.addEventListener('input', calcularUsdtTo);
        refreshBtn.addEventListener('click', obtenerTasas);

        obtenerTasas();
        setInterval(obtenerTasas, 300000); // 5 minutos
    </script>
</body>
</html>
